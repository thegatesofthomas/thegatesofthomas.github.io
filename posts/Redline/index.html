<!DOCTYPE html><html lang="en" data-mode="dark" ><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><meta name="generator" content="Jekyll v4.2.2" /><meta property="og:title" content="Malware Analysis - Redline Stealer" /><meta name="author" content="Thomas Gates" /><meta property="og:locale" content="en" /><meta name="description" content="This is my blog just for writing Malware Analysis articles and showing off my coding projects." /><meta property="og:description" content="This is my blog just for writing Malware Analysis articles and showing off my coding projects." /><link rel="canonical" href="https://thegatesofthomas.github.io//posts/Redline/" /><meta property="og:url" content="https://thegatesofthomas.github.io//posts/Redline/" /><meta property="og:site_name" content="thegatesofthomas" /><meta property="og:type" content="article" /><meta property="article:published_time" content="2023-09-27T11:30:00-04:00" /><meta name="twitter:card" content="summary" /><meta property="twitter:title" content="Malware Analysis - Redline Stealer" /><meta name="twitter:site" content="@twitter_username" /><meta name="twitter:creator" content="@Thomas Gates" /> <script type="application/ld+json"> {"@context":"https://schema.org","@type":"BlogPosting","author":{"@type":"Person","name":"Thomas Gates"},"dateModified":"2023-09-27T16:23:18-04:00","datePublished":"2023-09-27T11:30:00-04:00","description":"This is my blog just for writing Malware Analysis articles and showing off my coding projects.","headline":"Malware Analysis - Redline Stealer","mainEntityOfPage":{"@type":"WebPage","@id":"https://thegatesofthomas.github.io//posts/Redline/"},"url":"https://thegatesofthomas.github.io//posts/Redline/"}</script><title>Malware Analysis - Redline Stealer | thegatesofthomas</title><link rel="apple-touch-icon" sizes="180x180" href="/assets/img/favicons/apple-touch-icon.png"><link rel="icon" type="image/png" sizes="32x32" href="/assets/img/favicons/favicon-32x32.png"><link rel="icon" type="image/png" sizes="16x16" href="/assets/img/favicons/favicon-16x16.png"><link rel="manifest" href="/assets/img/favicons/site.webmanifest"><link rel="shortcut icon" href="/assets/img/favicons/favicon.ico"><meta name="apple-mobile-web-app-title" content="thegatesofthomas"><meta name="application-name" content="thegatesofthomas"><meta name="msapplication-TileColor" content="#da532c"><meta name="msapplication-config" content="/assets/img/favicons/browserconfig.xml"><meta name="theme-color" content="#ffffff"><link rel="preconnect" href="https://fonts.googleapis.com" ><link rel="dns-prefetch" href="https://fonts.googleapis.com" ><link rel="preconnect" href="https://fonts.gstatic.com" crossorigin><link rel="dns-prefetch" href="https://fonts.gstatic.com" crossorigin><link rel="preconnect" href="https://fonts.googleapis.com" ><link rel="dns-prefetch" href="https://fonts.googleapis.com" ><link rel="preconnect" href="https://cdn.jsdelivr.net" ><link rel="dns-prefetch" href="https://cdn.jsdelivr.net" ><link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Lato&family=Source+Sans+Pro:wght@400;600;700;900&display=swap"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4/dist/css/bootstrap.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5.11.2/css/all.min.css"><link rel="stylesheet" href="/assets/css/style.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@1.0.1/dist/bootstrap-toc.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/magnific-popup@1/dist/magnific-popup.min.css"> <script src="https://cdn.jsdelivr.net/npm/jquery@3/dist/jquery.min.js"></script><body data-spy="scroll" data-target="#toc" data-topbar-visible="true"><div id="sidebar" class="d-flex flex-column align-items-end"><div class="profile-wrapper text-center"><div id="avatar"> <a href="/" alt="avatar" class="mx-auto"> <img src=" https://avatars.githubusercontent.com/u/25987847?v=4 " alt="avatar" onerror="this.style.display='none'"> </a></div><div class="site-title mt-3"> <a href="/">thegatesofthomas</a></div><div class="site-subtitle font-italic">Malware Analysis/Coding Blog</div></div><ul class="w-100"><li class="nav-item"> <a href="/" class="nav-link"> <i class="fa-fw fas fa-home ml-xl-3 mr-xl-3 unloaded"></i> <span>HOME</span> </a><li class="nav-item"> <a href="/categories/" class="nav-link"> <i class="fa-fw fas fa-stream ml-xl-3 mr-xl-3 unloaded"></i> <span>CATEGORIES</span> </a><li class="nav-item"> <a href="/tags/" class="nav-link"> <i class="fa-fw fas fa-tag ml-xl-3 mr-xl-3 unloaded"></i> <span>TAGS</span> </a><li class="nav-item"> <a href="/archives/" class="nav-link"> <i class="fa-fw fas fa-archive ml-xl-3 mr-xl-3 unloaded"></i> <span>ARCHIVES</span> </a><li class="nav-item"> <a href="/about/" class="nav-link"> <i class="fa-fw fas fa-info-circle ml-xl-3 mr-xl-3 unloaded"></i> <span>ABOUT</span> </a></ul><div class="sidebar-bottom mt-auto d-flex flex-wrap justify-content-center align-items-center"> <a href="https://github.com/thegatesofthomas" aria-label="github" target="_blank" rel="noopener"> <i class="fab fa-github"></i> </a> <a href="https://www.linkedin.com/in/thomas-gates-ba380a196/" aria-label="linkedin" target="_blank" rel="noopener"> <i class="fab fa-linkedin"></i> </a> <a href="https://tryhackme.com/p/Vintorez" aria-label="tryhackme" target="_blank" rel="noopener"> <i class="fa fa-cloud"></i> </a> <a href=" javascript:location.href = 'mailto:' + ['thegatesofthomas','gmail.com'].join('@')" aria-label="email" > <i class="fas fa-envelope"></i> </a></div></div><div id="topbar-wrapper" class="row justify-content-center"><div id="topbar" class="col-11 d-flex h-100 align-items-center justify-content-between"> <span id="breadcrumb"> <span> <a href="/"> Home </a> </span> <span>Malware Analysis - Redline Stealer</span> </span> <i id="sidebar-trigger" class="fas fa-bars fa-fw"></i><div id="topbar-title"> Post</div><i id="search-trigger" class="fas fa-search fa-fw"></i> <span id="search-wrapper" class="align-items-center"> <i class="fas fa-search fa-fw"></i> <input class="form-control" id="search-input" type="search" aria-label="search" autocomplete="off" placeholder="Search..."> </span> <span id="search-cancel" >Cancel</span></div></div><div id="main-wrapper"><div id="main"><div class="row"><div id="core-wrapper" class="col-12 col-lg-11 col-xl-8"><div class="post pl-1 pr-1 pl-sm-2 pr-sm-2 pl-md-4 pr-md-4"><h1 data-toc-skip>Malware Analysis - Redline Stealer</h1><div class="post-meta text-muted"><div> By <em> <a href="https://twitter.com/username">Thomas Gates</a> </em></div><div class="d-flex"><div> <span> Posted <em class="timeago" data-ts="1695828600" data-toggle="tooltip" data-placement="bottom" data-tooltip-df="llll" > 2023-09-27 </em> </span> <span> Updated <em class="timeago" data-ts="1695846198" data-toggle="tooltip" data-placement="bottom" data-tooltip-df="llll" > 2023-09-27 </em> </span> <span class="readtime" data-toggle="tooltip" data-placement="bottom" title="1942 words"> <em>10 min</em> read</span></div></div></div><div class="post-content"><p><img data-src="/assets/img/redlineStealer/redline.png" alt="" data-proofer-ignore></p><h2 id="introduction"><span class="mr-2"><strong><span style="color:#ff5555"><span class="mr-2">Introduction</span></strong></span><a href="#introduction" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2></h2><p>Today I will be analyzing the very well known malware known as Redline Stealer. This malware is known for harvesting saved credentials, credit card info and other information about a host. This malware can typically upload and download files and will periodically send information back to a C2 domain. It can often be spotted as a MaaS (Malware as a service) in darkweb forums.</p><h2 id="tools-used"><span class="mr-2"><strong><span style="color:#ff5555"><span class="mr-2">Tools Used</span></strong></span><a href="#tools-used" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2></h2><ul><li>Detect-It-Easy<li>NetReactorS Slayer<li>inetsim<li>wireshark<li>pestudio<li>procmon<li>dnspy<li>de4dot<li>CyberChef</ul><h2 id="link-to-sample"><span class="mr-2"><strong><span style="color:#ff5555"><span class="mr-2">Link to Sample:</span></strong></span><a href="#link-to-sample" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2></h2><p>https://bazaar.abuse.ch/sample/8a839a1497379639e18a64b3f69f8f1a5d70341a666c91d5a13d24fecd05799f/</p><h2 id="iocs-defanged"><span class="mr-2"><strong><span style="color:#ff5555"><span class="mr-2">IOCs (defanged)</span></strong></span><a href="#iocs-defanged" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2></h2><p>Hashes-</p><p>8a839a1497379639e18a64b3f69f8f1a5d70341a666c91d5a13d24fecd05799f (1st Payload) a7c1c1bb1cb6996be53907169a49b1b6d7c34a6dbb99c47538ce781e844d00a9 (2nd Payload exe) 5c03d43bf03feb867d7738b2697d9d44fe09fc2d97e681559f09cfa998ec0d77 (2nd Payload DLL)</p><p>IPs-</p><p>194[.]180[.]49[.]211</p><p>URLs-</p><p>hxxp[://]194[.]180[.]49[.]211/D/fweb[.]txt</p><p>hxxp[://]194[.]180[.]49[.]211/D/DLLL[.]txt</p><h1 id="-payload-1-"><strong><span style="color:#ff5555"> Payload 1 </span></strong></h1><h2 id="-deobfuscation-"><span class="mr-2"><strong><span style="color:#ff5555"><span class="mr-2"> Deobfuscation </span></strong></span><a href="#-deobfuscation-" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2></h2><p>Starting out with our first payload we can load it into pestudio we can observe multiple indications that this is a .NET Binary. This is good as this means we can use tools such as DNSpy to decompile this binary.</p><p><img data-src="/assets/img/redlineStealer/1.png" alt="" data-proofer-ignore></p><p>Further reviewing the binary we can see that most of the raw sizes and virtual sizes are similar except in the .data section which indicates some packing may be present.</p><p><img data-src="/assets/img/redlineStealer/2.5.png" alt="" data-proofer-ignore></p><p>Skipping somewhat ahead when loaded into dnspy it can be seen that almost nothing shows up which supports this is most likely packed.</p><p><img data-src="/assets/img/redlineStealer/3.png" alt="" data-proofer-ignore></p><p>Firing up Detect-It-Easy we can observe that this binary contains the protector “.NET Reactor”.</p><p><img data-src="/assets/img/redlineStealer/4.png" alt="" data-proofer-ignore></p><p>After a little research we can find that this packer is “slayed” easily by a tool called “NetReactorS Slayer” which is lucky for us as the FlareVM suite of tools comes with this tool preloaded and has a nifty little GUI to compliment it.</p><p><img data-src="/assets/img/redlineStealer/5.png" alt="" data-proofer-ignore></p><p>After running NETSlayer we can see this binary is now readable and we can finally begin our static analysis.</p><p><img data-src="/assets/img/redlineStealer/6.png" alt="" data-proofer-ignore></p><p>As a final clean up we are going to run this through de4dot.exe just to clean up any loose ends.</p><p><img data-src="/assets/img/redlineStealer/7.png" alt="" data-proofer-ignore></p><h2 id="basic-static-analysis-"><span class="mr-2"><strong><span style="color:#ff5555"><span class="mr-2">Basic Static Analysis </span></strong></span><a href="#basic-static-analysis-" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2></h2><p>Running the binary back into pestudio we can observe a suspicious compiler stamp dated October 22nd, 2077.</p><p><img data-src="/assets/img/redlineStealer/8.png" alt="" data-proofer-ignore></p><p>Moving on to the imports we can see many Web related API calls being made.</p><p><img data-src="/assets/img/redlineStealer/9.png" alt="" data-proofer-ignore></p><p>We also can see imports for Base64 encoding which indicates this encodes some sort of data.</p><p><img data-src="/assets/img/redlineStealer/10.png" alt="" data-proofer-ignore></p><p>Finally reaching the strings we can see more indicators of HTTP web requests and Base64 Encoding/Decoding.</p><p><img data-src="/assets/img/redlineStealer/11.png" alt="" data-proofer-ignore></p><p>Scrolling down further we can find two very interesting strings for URLs which indicates there is a second payload or even a C2 server.</p><p><img data-src="/assets/img/redlineStealer/12.png" alt="" data-proofer-ignore></p><p>For fun I also ran this binary through floss because it picks out and decodes some strings more effectively than other tools. Some other of notable strings are related to querying file locations</p><p><img data-src="/assets/img/redlineStealer/13.png" alt="" data-proofer-ignore></p><h2 id="-basic-dynamic-analysis-"><span class="mr-2"><strong><span style="color:#ff5555"><span class="mr-2"> Basic Dynamic Analysis </span></strong></span><a href="#-basic-dynamic-analysis-" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2></h2><p>For my dynamic analysis I used inetsim and wireshark running on a remnux host on the same network to catch any DNS requests being made. I detonated the sample and recorded. First we will run this binary without inetsim running to see what it does. Nothing unusual occurred and the binary did not not react besides showing an error.</p><p><img data-src="/assets/img/redlineStealer/14.png" alt="" data-proofer-ignore></p><p>After this we run inetsim and redetonate the sample.</p><p><img data-src="/assets/img/redlineStealer/15.png" alt="" data-proofer-ignore></p><p>We don’t observe a whole lot besides TLS which only tells us that this is utilizing TLS to mask its connections. The same activity was still observed with inetsim off and on so it most likely doesnt check for internet access.</p><p>Moving on to Procmon we run this without inetsim active again. No network activity is observed though it can be seen accessing dlls such as dhcpsvc6.dll and dnsapi.dll. Running the binary with inetsim active reveals nothing different. Further reviewing the registry activity shows the process querying the Internet Settings.</p><p><img data-src="/assets/img/redlineStealer/16.png" alt="" data-proofer-ignore></p><p>Examining the child processes by setting the sample’s PID to parent PID shows multiple network connections spawned from WerFault.exe but WerFault is used for error reporting so this could just be typical WerFault activity.</p><p><img data-src="/assets/img/redlineStealer/17.png" alt="" data-proofer-ignore></p><p>Next it can be seen that WerFault can be seen setting the Image File Executions to make the program run on start. This is a common tactic to maintain persistence for malware so this will run whenever the host starts up.</p><p><img data-src="/assets/img/redlineStealer/18.png" alt="" data-proofer-ignore></p><p><img data-src="/assets/img/redlineStealer/19.png" alt="" data-proofer-ignore></p><h2 id="advanced-static-analysis-"><span class="mr-2"><strong><span style="color:#ff5555"><span class="mr-2">Advanced Static Analysis </span></strong></span><a href="#advanced-static-analysis-" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2></h2><p>Jumping into the Advanced Static we throw our cleaned sample in and begin to read through it. We find our main method which gives us a lot of information.</p><p><img data-src="/assets/img/redlineStealer/20.png" alt="" data-proofer-ignore></p><p>We can see that this binary uses TLS to make a GET request to the URL hxxp[://]194[.]180[.]49[.]211/D/fweb[.]txt and saves it to the diretory where the program Caspol.exe is located. Caspol is the Code Access Security (CAS) Policy tool (<em>Caspol</em>.<em>exe</em>) enables users and administrators to modify security policy for the machine. This is most likely grabs another payload which is encoded into Base64. Another payload is also loaded from the URL hxxp[://]194[.]180[.]49[.]211/D/DLLL[.]txt which is most likely a DLL. Putting both of these URLs into URLscan.io pulls back large Base64 encoded strings which is our next payload. Conducting OSINT on the IP shows this is hosted with DDNS which is used for remote access with Dynamic DNS.</p><p><img data-src="/assets/img/redlineStealer/21.png" alt="" data-proofer-ignore></p><p>Further diving in we see one other part of this program which relates the Image File Execution.</p><p><img data-src="/assets/img/redlineStealer/22.png" alt="" data-proofer-ignore></p><h2 id="advanced-dynamic-analysis-"><span class="mr-2"><strong><span style="color:#ff5555"><span class="mr-2">Advanced Dynamic Analysis </span></strong></span><a href="#advanced-dynamic-analysis-" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2></h2><p>Now that we have analyzed basically all of the first payload statically we can debug this program to see exactly how it runs. Lucky for us DNspy has its own built in debugger.</p><p><img data-src="/assets/img/redlineStealer/23.png" alt="" data-proofer-ignore></p><p>As we begin to debug the first thing this program does is reach out to this domain.</p><p><img data-src="/assets/img/redlineStealer/24.png" alt="" data-proofer-ignore></p><p>Sadly it seems even with our trusty inetsim cannot fool this program but lucky for us we already got the next payloads on our own. Sadly I am not proficient enough with a debugger to get around this but we can see the program in is entirety so this all that matters.</p><p>Just to reiterate the way we got this payload what I did was get the URLs from the first payload and I used URLScan.io to grab the next stage of the payload as seen in the screenshots below</p><p><img data-src="/assets/img/redlineStealer/25.png" alt="" data-proofer-ignore></p><p><img data-src="/assets/img/redlineStealer/26.png" alt="" data-proofer-ignore></p><h1 id="-payload-2-"><strong><span style="color:#ff5555"> Payload 2 </span></strong></h1><h2 id="deobfuscation-"><span class="mr-2"><strong><span style="color:#ff5555"><span class="mr-2">Deobfuscation </span></strong></span><a href="#deobfuscation-" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2></h2><p>We can see in the first payload that this is pulled down and converted from Base64 so we can easily run this through Cyberchef.</p><p><img data-src="/assets/img/redlineStealer/27.png" alt="" data-proofer-ignore></p><p>When decoded we can see that the resulting output has a file header of MZ which is associated with DOS executables. As a result we can export this as a .exe file.</p><p>Next we have our supposed DLL download from “hxxp[://]194[.]180[.]49[.]211/D/DLLL[.]txt”.</p><p><img data-src="/assets/img/redlineStealer/28.png" alt="" data-proofer-ignore></p><p>The file contains the same file header but judging by the name of the txt file it would be safe to assume that this is a dll instead of a exe so we will export it as such. Finally we will run these through de4dot just incase even though these payloads dont seem to be obfuscated very well.</p><h2 id="basic-static-analysis--1"><span class="mr-2"><strong><span style="color:#ff5555"><span class="mr-2">Basic Static Analysis </span></strong></span><a href="#basic-static-analysis--1" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2></h2><p>Jumping into it we are going to throw our exe file into pestudio we can see our first interesting clues on the functionality of this binary within the imports.</p><p><img data-src="/assets/img/redlineStealer/29.png" alt="" data-proofer-ignore></p><p>We can see lots of registry activity which means this could maintain persistence or query keys. Additionally we see Credential Cache which is definitely important as this is redline stealer and that would be the golden goose for this malware. Other imports such as JavaScript Serializer is interesting as this may be a way for this malware to communicate with its C2 server. Finally we can see SMTP and Mail Address which is used for emails. Its unclear at this point if this is stealing email credentials or uses this as exfiltration. As for strings I am going to use Floss again.</p><p><img data-src="/assets/img/redlineStealer/30.png" alt="" data-proofer-ignore></p><p>The only new information I could find was more strings relating to passwords.</p><p>Next we are going to analyze the DLL that we pulled down. Yeeting this into PEStudio shows this was compiled in 2082 which is obviously impossible.</p><p><img data-src="/assets/img/redlineStealer/31.png" alt="" data-proofer-ignore></p><p>Moving onto the imports we can see some interesting imports such as login screen and we can see mentions of the Better module which we saw being referenced in the first payload.</p><p><img data-src="/assets/img/redlineStealer/32.png" alt="" data-proofer-ignore></p><p>Other strange function names can be spotted which when put through google translate seems to be turkish.</p><p><img data-src="/assets/img/redlineStealer/33.png" alt="" data-proofer-ignore></p><p>Within the .NET resources we can see that the namespace holds the name Better.dll.</p><p><img data-src="/assets/img/redlineStealer/34.png" alt="" data-proofer-ignore></p><p>Finally putting the DLL through floss we can see more indications of this attempting to setup a login screen which is unclear why it has this. My theory with this is that this is similar to the same technique that AgentTesla uses and packages itself legit functions and has its real payload hidden throughout. This is supported with the fact that when you put these binaries through VirusTotal they appear as AgentTesla. No other strange strings can be observed.</p><h2 id="basic-dynamic-analysis-"><span class="mr-2"><strong><span style="color:#ff5555"><span class="mr-2">Basic Dynamic Analysis </span></strong></span><a href="#basic-dynamic-analysis-" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2></h2><p>Network analysis still remains difficult as this binary utilizes TLS to make network requests which could be possible to analyze I just am not advanced enough yet or have the proper toolset to. Otherwise we are can continue with Procmon.</p><p><img data-src="/assets/img/redlineStealer/35.png" alt="" data-proofer-ignore></p><p>First thing we see is the binary attempting to maintain persistence within the Image File Execution. Other Registry actions that can be seen are querying Outlook, Foxmail, WinSCP, WinVNC4, TightVNC and COREFTP.</p><p><img data-src="/assets/img/redlineStealer/36.png" alt="" data-proofer-ignore></p><p>Moving on to the file operations we can see this binary querying various browser credential storage directories which is typical of Redline Stealer.</p><p><img data-src="/assets/img/redlineStealer/37.png" alt="" data-proofer-ignore></p><p><img data-src="/assets/img/redlineStealer/38.png" alt="" data-proofer-ignore></p><p><img data-src="/assets/img/redlineStealer/39.png" alt="" data-proofer-ignore></p><p><img data-src="/assets/img/redlineStealer/40.png" alt="" data-proofer-ignore></p><p><img data-src="/assets/img/redlineStealer/41.png" alt="" data-proofer-ignore></p><h2 id="advanced-static-analysis--1"><span class="mr-2"><strong><span style="color:#ff5555"><span class="mr-2">Advanced Static Analysis </span></strong></span><a href="#advanced-static-analysis--1" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2></h2><p>Next we will be using Dnspy to analyze both the EXE and DLL. Putting our binary in DNSpy shows we have an entry point. The first thing this binary does is create a TLS connection. Trespassing the binary we can see that this binary grabs System Information</p><p><img data-src="/assets/img/redlineStealer/42.png" alt="" data-proofer-ignore></p><p>other functions we can see are querying modules and windows hooks</p><p><img data-src="/assets/img/redlineStealer/43.png" alt="" data-proofer-ignore></p><p>It is highly probable that this binary is capable of keylogging as functions such as the one below.</p><p><img data-src="/assets/img/redlineStealer/44.png" alt="" data-proofer-ignore></p><p>Next we find a function where we can see a function that is sending mail which make it highly likely this is how this binary exfiltrates data.</p><p><img data-src="/assets/img/redlineStealer/45.png" alt="" data-proofer-ignore></p><p>Delving further into the binary we can see functions for querying specific folders which is most likely how this binary finds the directories where passwords are stored.</p><p><img data-src="/assets/img/redlineStealer/46.png" alt="" data-proofer-ignore></p><p>The way this malware works seems to mainly rely on a string builder and just queries all of its set file paths and just adds them to an array till its done encodes it in base64 and then sends it out through email.</p><p>Next we are going to put our DLL into DNSpy does not reveal much but it seems most of the functions are most likely related to process injection or hollowing as many of the functions are finding process IDs, byte streams, finding file locations, and manipulating arrays.</p><p><img data-src="/assets/img/redlineStealer/47.png" alt="" data-proofer-ignore></p><p><img data-src="/assets/img/redlineStealer/48.png" alt="" data-proofer-ignore></p><h2 id="advanced-dynamic-analysis--1"><span class="mr-2"><strong><span style="color:#ff5555"><span class="mr-2">Advanced Dynamic Analysis </span></strong></span><a href="#advanced-dynamic-analysis--1" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2></h2><p>Time for the fun part of malware analysis which is debugging. Our favorite tool Dnspy comes with a debugger so no x32dbg today. The way we are achieving this is by opening the DLL in dnspy and then loading the exe as our executable.</p><p><img data-src="/assets/img/redlineStealer/49.png" alt="" data-proofer-ignore></p><p>When this program starts up the first thing it does is check for a network connection and then figures out where its being launched as well as the user. The program then locates the Roaming folder.</p><p><img data-src="/assets/img/redlineStealer/50.png" alt="" data-proofer-ignore></p><p>Next it seems to looks for invalid paths and seems to want to persist in Roaming.</p><p>Finally it can be seen that this malware queries all of the password stores on this host from numerous mail, RDP and browser softwares.</p><p><img data-src="/assets/img/redlineStealer/51.png" alt="" data-proofer-ignore></p><p><img data-src="/assets/img/redlineStealer/52.png" alt="" data-proofer-ignore></p><p><img data-src="/assets/img/redlineStealer/53.png" alt="" data-proofer-ignore></p><p><img data-src="/assets/img/redlineStealer/54.png" alt="" data-proofer-ignore></p><p><img data-src="/assets/img/redlineStealer/55.png" alt="" data-proofer-ignore></p><p>This seems to be the extent of this malware and doesn’t seem to do much else. Its capabilities seem to be just stealing credentials hence the name Redline Stealer. The way this malware works is that it is launched by a loader and uses WerFault to pull down its next payload from an IP in which it then loads the core of Redline Stealer which then queries system information and password stores located on the host. It then grabs all of these stores and stores them into an array which when sends them as an email attachment.</p></div><div class="post-tail-wrapper text-muted"><div class="post-meta mb-3"> <i class="far fa-folder-open fa-fw mr-1"></i> <a href='/categories/malwareanalysis/'>MalwareAnalysis</a></div><div class="post-tags"> <i class="fa fa-tags fa-fw mr-1"></i> <a href="/tags/malware/" class="post-tag no-text-decoration" >Malware</a> <a href="/tags/net/" class="post-tag no-text-decoration" >Net</a> <a href="/tags/redline/" class="post-tag no-text-decoration" >Redline</a></div><div class="post-tail-bottom d-flex justify-content-between align-items-center mt-3 pt-5 pb-2"><div class="license-wrapper"> This post is licensed under <a href="https://creativecommons.org/licenses/by/4.0/"> CC BY 4.0 </a> by the author.</div><div class="share-wrapper"> <span class="share-label text-muted mr-1">Share</span> <span class="share-icons"> <a href="https://twitter.com/intent/tweet?text=Malware Analysis - Redline Stealer - thegatesofthomas&amp;url=https://thegatesofthomas.github.io//posts/Redline/" data-toggle="tooltip" data-placement="top" title="Twitter" target="_blank" rel="noopener" aria-label="Twitter"> <i class="fa-fw fab fa-twitter"></i> </a> <a href="https://www.facebook.com/sharer/sharer.php?title=Malware Analysis - Redline Stealer - thegatesofthomas&amp;u=https://thegatesofthomas.github.io//posts/Redline/" data-toggle="tooltip" data-placement="top" title="Facebook" target="_blank" rel="noopener" aria-label="Facebook"> <i class="fa-fw fab fa-facebook-square"></i> </a> <a href="https://t.me/share/url?url=https://thegatesofthomas.github.io//posts/Redline/&amp;text=Malware Analysis - Redline Stealer - thegatesofthomas" data-toggle="tooltip" data-placement="top" title="Telegram" target="_blank" rel="noopener" aria-label="Telegram"> <i class="fa-fw fab fa-telegram"></i> </a> <i id="copy-link" class="fa-fw fas fa-link small" data-toggle="tooltip" data-placement="top" title="Copy link" data-title-succeed="Link copied successfully!"> </i> </span></div></div></div></div></div><div id="panel-wrapper" class="col-xl-3 pl-2 text-muted"><div class="access"><div id="access-lastmod" class="post"><div class="panel-heading">Recently Updated</div><ul class="post-content pl-0 pb-1 ml-1 mt-2"><li><a href="/posts/Redline/">Malware Analysis - Redline Stealer</a><li><a href="/posts/STRRat/">Malware Analysis - STRrat</a><li><a href="/posts/Labs1/">Practical Malware Analysis Lab 1</a><li><a href="/posts/Havoc/">Havoc C2 Framework Demo</a><li><a href="/posts/HelloWorld/">Hello World</a></ul></div><div id="access-tags"><div class="panel-heading">Trending Tags</div><div class="d-flex flex-wrap mt-3 mb-1 mr-3"> <a class="post-tag" href="/tags/malware/">Malware</a> <a class="post-tag" href="/tags/lab/">Lab</a> <a class="post-tag" href="/tags/practicalmalwareanalysis/">PracticalMalwareAnalysis</a> <a class="post-tag" href="/tags/c2/">C2</a> <a class="post-tag" href="/tags/c/">C</a> <a class="post-tag" href="/tags/demo/">Demo</a> <a class="post-tag" href="/tags/framework/">Framework</a> <a class="post-tag" href="/tags/java/">Java</a> <a class="post-tag" href="/tags/javascript/">Javascript</a> <a class="post-tag" href="/tags/misc/">Misc</a></div></div></div><script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@1.0.1/dist/bootstrap-toc.min.js"></script><div id="toc-wrapper" class="pl-0 pr-4 mb-5"><div class="panel-heading pl-3 pt-2 mb-2">Contents</div><nav id="toc" data-toggle="toc"></nav></div></div></div><div class="row"><div class="col-12 col-lg-11 col-xl-8"><div id="tail-wrapper" class="pl-1 pr-1 pl-sm-2 pr-sm-2 pl-md-4 pr-md-4"><div id="related-posts" class="mt-5 mb-2 mb-sm-4"><h3 class="pt-2 mt-1 mb-4 ml-1" data-toc-skip>Further Reading</h3><div class="card-deck mb-4"><div class="card"> <a href="/posts/Labs1/"><div class="card-body"> <em class="timeago small" data-ts="1661530560" > 2022-08-26 </em><h3 class="pt-0 mt-1 mb-3" data-toc-skip>Practical Malware Analysis Lab 1</h3><div class="text-muted small"><p> Practical Malware Analysis Labs Hello I am just drawing attention to my github where I will be uploading all the labs I am doing in a book I recently purchased called Practical Malware Analysis: T...</p></div></div></a></div><div class="card"> <a href="/posts/Labs5/"><div class="card-body"> <em class="timeago small" data-ts="1676218560" > 2023-02-12 </em><h3 class="pt-0 mt-1 mb-3" data-toc-skip>Practical Malware Analysis Lab 3 + 5</h3><div class="text-muted small"><p> Practical Malware Analysis Labs Where have I been? Hello, Its been a while. I have been working on things I promise. I have put two new labs up and I will have a seperate set of C projects. Lab...</p></div></div></a></div><div class="card"> <a href="/posts/STRRat/"><div class="card-body"> <em class="timeago small" data-ts="1657553400" > 2022-07-11 </em><h3 class="pt-0 mt-1 mb-3" data-toc-skip>Malware Analysis - STRrat</h3><div class="text-muted small"><p> Summary STRrat is a Java based attack that works by heavily obsefucating its code through allatori obefusacter. The interesting part about this malware is that it does not care whether Java is in...</p></div></div></a></div></div></div><div class="post-navigation d-flex justify-content-between"> <a href="/posts/PiHole/" class="btn btn-outline-primary" prompt="Older"><p>PiHole</p></a> <span class="btn btn-outline-primary disabled" prompt="Newer"><p>-</p></span></div></div></div></div><footer class="d-flex w-100 justify-content-center"><div class="d-flex justify-content-between align-items-center text-muted"><div class="footer-left"><p class="mb-0"> © 2023 <a href="https://twitter.com/username">Thomas Gates</a>. <span data-toggle="tooltip" data-placement="top" title="Except where otherwise noted, the blog posts on this site are licensed under the Creative Commons Attribution 4.0 International (CC BY 4.0) License by the author.">Some rights reserved.</span></p></div><div class="footer-right"><p class="mb-0"> Powered by <a href="https://jekyllrb.com" target="_blank" rel="noopener">Jekyll</a> with <a href="https://github.com/cotes2020/jekyll-theme-chirpy" target="_blank" rel="noopener">Chirpy</a> theme.</p></div></div></footer></div><div id="search-result-wrapper" class="d-flex justify-content-center unloaded"><div class="col-12 col-sm-11 post-content"><div id="search-hints"><div id="access-tags"><div class="panel-heading">Trending Tags</div><div class="d-flex flex-wrap mt-3 mb-1 mr-3"> <a class="post-tag" href="/tags/malware/">Malware</a> <a class="post-tag" href="/tags/lab/">Lab</a> <a class="post-tag" href="/tags/practicalmalwareanalysis/">PracticalMalwareAnalysis</a> <a class="post-tag" href="/tags/c2/">C2</a> <a class="post-tag" href="/tags/c/">C</a> <a class="post-tag" href="/tags/demo/">Demo</a> <a class="post-tag" href="/tags/framework/">Framework</a> <a class="post-tag" href="/tags/java/">Java</a> <a class="post-tag" href="/tags/javascript/">Javascript</a> <a class="post-tag" href="/tags/misc/">Misc</a></div></div></div><div id="search-results" class="d-flex flex-wrap justify-content-center text-muted mt-3"></div></div></div></div><div id="mask"></div><a id="back-to-top" href="#" aria-label="back-to-top" class="btn btn-lg btn-box-shadow" role="button"> <i class="fas fa-angle-up"></i> </a> <script src="https://cdn.jsdelivr.net/npm/simple-jekyll-search@1.10.0/dest/simple-jekyll-search.min.js"></script> <script> SimpleJekyllSearch({ searchInput: document.getElementById('search-input'), resultsContainer: document.getElementById('search-results'), json: '/assets/js/data/search.json', searchResultTemplate: '<div class="pl-1 pr-1 pl-sm-2 pr-sm-2 pl-lg-4 pr-lg-4 pl-xl-0 pr-xl-0"> <a href="{url}">{title}</a><div class="post-meta d-flex flex-column flex-sm-row text-muted mt-1 mb-1"> {categories} {tags}</div><p>{snippet}</p></div>', noResultsText: '<p class="mt-5">Oops! No result founds.</p>', templateMiddleware: function(prop, value, template) { if (prop === 'categories') { if (value === '') { return `${value}`; } else { return `<div class="mr-sm-4"><i class="far fa-folder fa-fw"></i>${value}</div>`; } } if (prop === 'tags') { if (value === '') { return `${value}`; } else { return `<div><i class="fa fa-tag fa-fw"></i>${value}</div>`; } } } }); </script> <script src="https://cdn.jsdelivr.net/combine/npm/magnific-popup@1/dist/jquery.magnific-popup.min.js,npm/lozad/dist/lozad.min.js,npm/clipboard@2/dist/clipboard.min.js"></script> <script src="https://cdn.jsdelivr.net/combine/npm/dayjs@1/dayjs.min.js,npm/dayjs@1/locale/en.min.js,npm/dayjs@1/plugin/relativeTime.min.js,npm/dayjs@1/plugin/localizedFormat.min.js"></script> <script defer src="/assets/js/dist/post.min.js"></script> <script src="https://cdn.jsdelivr.net/npm/bootstrap@4/dist/js/bootstrap.bundle.min.js"></script> <script defer src="/app.js"></script>
